<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shopping Cart</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    color: #232F3E;
    font-size: 18px;
    margin: 10px 0;
  }

  .nav-link {
    display: block;
    text-align: center;
    margin-bottom: 15px;
    color: #0066cc;
    text-decoration: none;
    font-weight: bold;
    font-size: 12px;
  }

  #cart-container {
    max-width: 800px;
    margin: 0 auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    font-size: 12px;
  }

  th {
    background-color: #232F3E;
    color: white;
    font-size: 12px;
  }

  .product-img {
    width: 20px;
    height: 20px;
    border-radius: 2px;
    object-fit: cover;
  }

  .qty-btn {
    padding: 2px 6px;
    margin: 0 3px;
    background: #f0f0f0;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    font-size: 11px;
  }

  .remove-btn {
    padding: 2px 6px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    font-size: 11px;
  }

  .total-section {
    margin-top: 15px;
    text-align: right;
    font-size: 1em;
    font-weight: bold;
  }

  .empty-msg {
    text-align: center;
    color: #888;
    margin-top: 30px;
    font-size: 14px;
  }

  .checkout-btn {
    display: block;
    margin: 15px auto;
    padding: 12px 30px;
    background: #FF9900;
    color: white;
    border: none;
    border-radius: 3px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .checkout-btn:hover {
    background: #ff8c00;
  }

  /* order form modal */
  #order-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }
  #order-form {
    background: #fff;
    padding: 20px;
    border-radius: 6px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  }
  #order-form h2{margin-top:0}
  .form-row{margin-bottom:10px}
  .form-row label{display:block;font-size:13px;margin-bottom:4px}
  .form-row input, .form-row textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:13px}
  .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .btn-secondary{background:#eee;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}
  .btn-primary{background:#28a745;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}
</style>
</head>
<body>

<h1>Shopping Cart</h1>
<a href="index.html" class="nav-link">← Back to Shopping</a>

<div id="cart-container">
  <div id="empty-cart" class="empty-msg" style="display:none;">Your cart is empty!</div>
  <table id="cart-table" style="display:none;">
    <thead>
      <tr>
        <th>Product</th>
        <th>Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="total-section">
    Grand Total: <span id="grand-total">₹0</span>
  </div>
  <button class="checkout-btn" onclick="checkout()">Click Here to Place Order</button>
</div>

<!-- Order modal -->
<div id="order-modal">
  <div id="order-form">
    <h2>Place Order</h2>
    <div id="order-summary" style="margin-bottom:12px;font-size:14px;color:#333"></div>
    <div class="form-row">
      <label for="customer-name">Full name</label>
      <input id="customer-name" placeholder="e.g. John Doe">
    </div>
    <div class="form-row">
      <label for="customer-phone">Phone number</label>
      <input id="customer-phone" placeholder="10-digit phone number">
    </div>
    <div class="form-row">
      <label for="customer-address">Address</label>
      <textarea id="customer-address" rows="3" placeholder="Delivery address"></textarea>
    </div>
    <div style="font-size:13px;color:#666">Note: quantities shown are taken from your cart. Adjust quantities on the cart before placing order.</div>
    <div class="form-actions">
      <button class="btn-secondary" onclick="closeOrderModal()">Cancel</button>
      <button class="btn-primary" onclick="placeOrder()">Place Order</button>
    </div>
  </div>
</div>

<script>
function renderCart() {
  const cartTable = document.getElementById('cart-table');
  const emptyCart = document.getElementById('empty-cart');
  const tbody = cartTable.querySelector('tbody');
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  
  if (cart.length === 0) {
    cartTable.style.display = 'none';
    emptyCart.style.display = 'block';
    return;
  }

  cartTable.style.display = 'table';
  emptyCart.style.display = 'none';
  tbody.innerHTML = '';
  let grandTotal = 0;

  cart.forEach((item, index) => {
    const total = item.price * item.quantity;
    grandTotal += total;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td><img src="${item.img}" alt="${item.name}" class="product-img"></td>
      <td>${item.name}</td>
      <td>₹${item.price}</td>
      <td>
        <button class="qty-btn" onclick="updateQuantity(${index}, -1)">−</button>
        ${item.quantity}
        <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
      </td>
      <td>₹${total}</td>
      <td><button class="remove-btn" onclick="removeItem(${index})">Remove</button></td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById('grand-total').textContent = `₹${grandTotal}`;
}

function updateQuantity(index, change) {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  
  if (cart[index].quantity + change < 1) {
    removeItem(index);
    return;
  }
  
  cart[index].quantity += change;
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

function removeItem(index) {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart.splice(index, 1);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

function checkout() {
  // open the order modal and populate summary
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  if (cart.length === 0) {
    alert('Your cart is empty. Add items before checkout.');
    return;
  }
  const summaryEl = document.getElementById('order-summary');
  let text = '';
  let grand = 0;
  cart.forEach(item => {
    const total = item.price * item.quantity;
    grand += total;
    text += `${item.name} x ${item.quantity} — ₹${total} \n`;
  });
  text += `\nGrand Total: ₹${grand}`;
  // show in modal
  summaryEl.textContent = text;
  document.getElementById('order-modal').style.display = 'flex';
}

function closeOrderModal(){
  document.getElementById('order-modal').style.display = 'none';
}

function placeOrder(){
  try {
    console.log('placeOrder: start');
    const name = (document.getElementById('customer-name').value || '').trim();
    const phone = (document.getElementById('customer-phone').value || '').trim();
    const address = (document.getElementById('customer-address').value || '').trim();
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    // basic validation
    if (!name) { alert('Please enter your full name'); return; }
    if (!phone || !/^\d{10}$/.test(phone)) { alert('Please enter a valid 10-digit phone number'); return; }
    if (!address) { alert('Please enter your delivery address'); return; }
    if (cart.length === 0) { alert('Your cart is empty'); closeOrderModal(); return; }

    const grandTotal = cart.reduce((s,it) => s + (Number(it.price)||0)*(Number(it.quantity)||0), 0);
    const order = {
      id: 'ORD' + Date.now(),
      name, phone, address,
      items: cart,
      total: grandTotal,
      date: new Date().toISOString()
    };

    // save to orders in localStorage
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    // clear cart and UI
    localStorage.removeItem('cart');
    renderCart();
    closeOrderModal();

    // show confirmation
    alert('Order placed!\nOrder ID: ' + order.id + '\nWe will contact you at ' + phone);
    console.log('placeOrder: success', order);
  } catch (err) {
    console.error('placeOrder: error', err);
    alert('An error occurred while placing the order. Check console for details.');
  }
}

// Initialize the cart display
renderCart();
</script>

</body>
</html>